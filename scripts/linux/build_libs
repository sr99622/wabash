#!/bin/bash

cd scripts/linux

export LD_RUN_PATH='$ORIGIN'
export ACLOCAL_PATH=/usr/share/aclocal
export LIBXML2_INCLUDE_DIRS=$HOME/libxml2_build/include/libxml2
export LIBXML2_LIBRARIES=$HOME/libxml2_build/lib/libxml2.so
export PKG_CONFIG_PATH=$HOME/ffmpeg_build/lib/pkgconfig
export SDL2_DIR=$HOME/ffmpeg_build

rm -rf $HOME/ffmpeg_build
mkdir -p $HOME/ffmpeg_sources 
mkdir -p $HOME/bin
mkdir -p $HOME/sources
rm -rf $HOME/libxml2_build
mkdir -p $HOME/libxml2_sources

./prerequisites

./build_cmake && \
./build_automake && \
./build_libxml2 && \
./build_nasm && \
./build_h264 && \
./build_h265 && \
./build_aac && \
./build_sdl2 && \
./build_ffmpeg

cd ../..
cp -R $HOME/ffmpeg_build ffmpeg
python3.10 -m venv env
source env/bin/activate
pip install -v .
export executable=$PWD/wabash/_wabash*
scripts/linux/copy_libs
pip install -v .
